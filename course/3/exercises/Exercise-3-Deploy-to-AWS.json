{"status":{},"contains_secrets":true,"product_version":"3.0.0.1","spec":{"description":"Production 3-Tier Application","resources":{"client_attrs":{"None":{"y":-488.0171595982,"x":-249.3757106236},"fe5242fd_deployment":{"y":-488.0171595982,"x":-249.3757106236},"fde022dc_deployment":{"y":-485.4100243705,"x":-564.9828534808}},"service_definition_list":[{"singleton":false,"action_list":[{"description":"System action for creating an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"WebServer"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"c4df580e_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"46e14386_runbook","main_task_local_reference":{"kind":"app_task","name":"c4df580e_dag"},"variable_list":[]},"name":"action_create"},{"description":"System action for deleting an application. Deletes created VMs as well","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"WebServer"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"4d2cb64a_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"271b6adb_runbook","main_task_local_reference":{"kind":"app_task","name":"4d2cb64a_dag"},"variable_list":[]},"name":"action_delete"},{"description":"System action for starting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"WebServer"},"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Restart"}],"name":"ab2510b0_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"WebServer"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Restart","attrs":{"type":"CALL_RUNBOOK","inarg_list":[],"runbook_reference":{"kind":"app_runbook","name":"d46e2c6e_runbook"}},"timeout_secs":"0","type":"CALL_RUNBOOK","variable_list":[]}],"description":"","name":"c44251df_runbook","main_task_local_reference":{"kind":"app_task","name":"ab2510b0_dag"},"variable_list":[]},"name":"action_start"},{"description":"System action for stopping an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"WebServer"},"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"WebServer_Stop"}],"name":"94da3199_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"WebServer"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"WebServer_Stop","attrs":{"exit_status":[],"script":"#!\/usr\/bin\/env bash\r\n\r\nsudo systemctl stop httpd\r\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"superuser"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"2c84d11e_runbook","main_task_local_reference":{"kind":"app_task","name":"94da3199_dag"},"variable_list":[]},"name":"action_stop"},{"description":"System action for restarting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"WebServer"},"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"WebServer_Restart"}],"name":"57935661_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"WebServer"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"WebServer_Restart","attrs":{"exit_status":[],"script":"#!\/usr\/bin\/env bash\r\n\r\nsudo systemctl restart httpd\r\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"superuser"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"d46e2c6e_runbook","main_task_local_reference":{"kind":"app_task","name":"57935661_dag"},"variable_list":[]},"name":"action_restart"}],"depends_on_list":[],"name":"WebServer","port_list":[],"tier":"","variable_list":[],"description":""},{"singleton":false,"action_list":[{"description":"System action for creating an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"HAProxy"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"04955ec8_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"0f2bfa19_runbook","main_task_local_reference":{"kind":"app_task","name":"04955ec8_dag"},"variable_list":[]},"name":"action_create"},{"description":"System action for deleting an application. Deletes created VMs as well","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"HAProxy"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"12c7fcb2_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"28b8813e_runbook","main_task_local_reference":{"kind":"app_task","name":"12c7fcb2_dag"},"variable_list":[]},"name":"action_delete"},{"description":"System action for starting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"HAProxy"},"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Restart"}],"name":"f4f9066c_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"HAProxy"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Restart","attrs":{"type":"CALL_RUNBOOK","inarg_list":[],"runbook_reference":{"kind":"app_runbook","name":"edeab12d_runbook"}},"timeout_secs":"0","type":"CALL_RUNBOOK","variable_list":[]}],"description":"","name":"f6a4799b_runbook","main_task_local_reference":{"kind":"app_task","name":"f4f9066c_dag"},"variable_list":[]},"name":"action_start"},{"description":"System action for stopping an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"HAProxy"},"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"HAProxy_Stop"}],"name":"21e8e8bb_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"HAProxy"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"HAProxy_Stop","attrs":{"exit_status":[],"script":"#!\/usr\/bin\/env bash\r\n\r\nsudo systemctl stop haproxy\r\nsudo systemctl daemon-reload\r\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"superuser"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"f4f51310_runbook","main_task_local_reference":{"kind":"app_task","name":"21e8e8bb_dag"},"variable_list":[]},"name":"action_stop"},{"description":"System action for restarting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"HAProxy"},"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"HAProxy_Restart"}],"name":"65b16430_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"HAProxy"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"HAProxy_Restart","attrs":{"exit_status":[],"script":"#!\/usr\/bin\/env bash\r\n\r\nsudo systemctl daemon-reload\r\nsudo systemctl restart haproxy\r\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"superuser"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"edeab12d_runbook","main_task_local_reference":{"kind":"app_task","name":"65b16430_dag"},"variable_list":[]},"name":"action_restart"}],"depends_on_list":[{"kind":"app_service","name":"WebServer"}],"name":"HAProxy","port_list":[],"tier":"","variable_list":[],"description":""}],"substrate_definition_list":[{"description":"","action_list":[],"type":"AWS_VM","name":"WebServerAWS","readiness_probe":{"connection_type":"SSH","retries":"5","connection_protocol":"","connection_port":22,"address":"@@{public_ip_address}@@","delay_secs":"60","disable_readiness_probe":false,"login_credential_local_reference":{"kind":"app_credential","name":"superuser"}},"os_type":"Linux","create_spec":{"name":"WebServer-@@{calm_array_index}@@-@@{calm_time}@@","availability_zone_reference":null,"backup_policy":null,"type":"PROVISION_AWS_VM","cluster_reference":null,"resources":{"instance_profile_name":"","availability_zone":"us-west-2a","subnet_id":"subnet-22ca2268","key_name":"HCE-KP","region":"us-west-2","instance_initiated_shutdown_behavior":"","user_data":"#cloud-config\r\n# https:\/\/aws.amazon.com\/premiumsupport\/knowledge-center\/ec2-user-account-cloud-init-user-data\/\r\n# omit: security-group of VPC for SSH?\r\n# omit: SSH-keypair in ec2 region, skips creation: ec2-user\r\ncloud_final_modules:\r\n  - [users-groups,always]\r\nusers:\r\n  - name: @@{superuser.username}@@\r\n    groups: [ wheel ]\r\n    sudo: [ \"ALL=(ALL) NOPASSWD:ALL\" ]\r\n    shell: \/bin\/bash\r\n    ssh-authorized-keys:\r\n      - @@{superuser.public_key}@@\r\n      - ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQC8ZzG4f1TfEZ2YRgDcPSQjb+fxbtRS4m1dr\/EcqwqIxiV6nU9Ft3PrTqC8qFkhBjOvSJJ3GeEMCZnvEK9Iq8F+R0G3pa29fZeRA8Ur3PM4d2kb2ZhEYLMmnhKJoSTJw4c5PxaZ4ZXKUH+yATQUsLrwoYsHEC6bAvKl0+yFspQYehaiEEO17o3KQUq\/izU7Agi4vETAuR7\/dlKwzj1sG8fikaf351gmQhIHd+nXxIY9yTA3CpvfeKTJ77aHN0Cg+HwXg9X+c0+P\/6zMfo87oru25qnPX5ITa2TfposQWp1xASGrrJX5B6rNYuQQKzVo5OO7VfFEKDsDlzGAkDVlD797xVoq+\/HN6G5gsi82jujBb1X9kyCLGFNhXsseGcqYelBMWmHKHTp69\/vnWcjT1dCB4OWEQr5ARcxYc5zNXV4N2CVYwH4iF70ztt4Dd7\/4gmvXWmzyuc0j7gd+QHz0BwxJTGZu+MPPXu8xAYtcCSAh\/SQFzL7xhnbsIrDj2mXBwOi36vxPQ8APRstr0dtEYivwyPyVb7lzR2SGmQNlHxB\/F\/xdiHszqD+\/c4DGZqW4xj+I6ICu\/19lh3gi2rLvrGF86EPTQ3hQKtpv6\/t2O+UXONnc+Ayc5dKh6baC6IbwGQnT0tLDPTXM5+o3M2a0KefdqmzL6\/gekpATS+scqb6tPQ== mark.lavi@nutanix.com-2018-05-21-passphraseless","image_id":"ami-01e78c5619c5e68b4","instance_type":"t2.micro","state":"RUNNING","security_group_list":[{"type":"","security_group_id":"sg-70cdc025"}],"block_device_map":{"data_disk_list":[],"type":"","root_disk":{"size_gb":10,"volume_type":"GP2","device_name":"\/dev\/sda1","iops":100,"snapshot_id":"","type":"","delete_on_termination":true}},"private_ip_address":"","vpc_id":"vpc-d3cdbfab","tag_list":[],"type":"","account_uuid":"dc1133f7-0255-60a9-9f38-f4b14e1b79d8","associate_public_ip_address":true}},"variable_list":[]},{"description":"","action_list":[],"type":"AWS_VM","name":"HAProxyAWS","readiness_probe":{"connection_type":"SSH","retries":"5","connection_protocol":"","connection_port":22,"address":"@@{public_ip_address}@@","delay_secs":"60","disable_readiness_probe":false,"login_credential_local_reference":{"kind":"app_credential","name":"superuser"}},"os_type":"Linux","create_spec":{"name":"HAProxy-@@{calm_array_index}@@-@@{calm_time}@@","availability_zone_reference":null,"backup_policy":null,"type":"PROVISION_AWS_VM","cluster_reference":null,"resources":{"instance_profile_name":"","availability_zone":"us-west-2a","subnet_id":"subnet-22ca2268","key_name":"HCE-KP","region":"us-west-2","instance_initiated_shutdown_behavior":"","user_data":"#cloud-config\r\n# https:\/\/aws.amazon.com\/premiumsupport\/knowledge-center\/ec2-user-account-cloud-init-user-data\/\r\n# omit: security-group of VPC for SSH?\r\n# omit: SSH-keypair in ec2 region, skips creation: ec2-user\r\ncloud_final_modules:\r\n  - [users-groups,always]\r\nusers:\r\n  - name: @@{superuser.username}@@\r\n    groups: [ wheel ]\r\n    sudo: [ \"ALL=(ALL) NOPASSWD:ALL\" ]\r\n    shell: \/bin\/bash\r\n    ssh-authorized-keys:\r\n      - @@{superuser.public_key}@@\r\n      - ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQC8ZzG4f1TfEZ2YRgDcPSQjb+fxbtRS4m1dr\/EcqwqIxiV6nU9Ft3PrTqC8qFkhBjOvSJJ3GeEMCZnvEK9Iq8F+R0G3pa29fZeRA8Ur3PM4d2kb2ZhEYLMmnhKJoSTJw4c5PxaZ4ZXKUH+yATQUsLrwoYsHEC6bAvKl0+yFspQYehaiEEO17o3KQUq\/izU7Agi4vETAuR7\/dlKwzj1sG8fikaf351gmQhIHd+nXxIY9yTA3CpvfeKTJ77aHN0Cg+HwXg9X+c0+P\/6zMfo87oru25qnPX5ITa2TfposQWp1xASGrrJX5B6rNYuQQKzVo5OO7VfFEKDsDlzGAkDVlD797xVoq+\/HN6G5gsi82jujBb1X9kyCLGFNhXsseGcqYelBMWmHKHTp69\/vnWcjT1dCB4OWEQr5ARcxYc5zNXV4N2CVYwH4iF70ztt4Dd7\/4gmvXWmzyuc0j7gd+QHz0BwxJTGZu+MPPXu8xAYtcCSAh\/SQFzL7xhnbsIrDj2mXBwOi36vxPQ8APRstr0dtEYivwyPyVb7lzR2SGmQNlHxB\/F\/xdiHszqD+\/c4DGZqW4xj+I6ICu\/19lh3gi2rLvrGF86EPTQ3hQKtpv6\/t2O+UXONnc+Ayc5dKh6baC6IbwGQnT0tLDPTXM5+o3M2a0KefdqmzL6\/gekpATS+scqb6tPQ== mark.lavi@nutanix.com-2018-05-21-passphraseless","image_id":"ami-01e78c5619c5e68b4","instance_type":"t2.micro","state":"RUNNING","security_group_list":[{"type":"","security_group_id":"sg-70cdc025"}],"block_device_map":{"data_disk_list":[],"type":"","root_disk":{"size_gb":10,"volume_type":"GP2","device_name":"\/dev\/sda1","iops":100,"snapshot_id":"","type":"","delete_on_termination":true}},"private_ip_address":"","vpc_id":"vpc-d3cdbfab","tag_list":[],"type":"","account_uuid":"dc1133f7-0255-60a9-9f38-f4b14e1b79d8","associate_public_ip_address":true}},"variable_list":[]}],"credential_definition_list":[{"username":"centos","description":"","type":"KEY","secret":{"attrs":{"is_secret_modified":true,"secret_reference":{}},"value":"\/HgkKq045pKTW+vk51jGL98c1u6H7nmuuzk7cJRBdhplT2ue3T440D44mN3FC7KPrd7gGopl0905W\/UV3mCdZjKt7cNw0hRSaszq0W061zWueALy148QjHi0Lf8VEAQvifl3gtf3XEd62DSVvCh0bMC8ck\/UW08moHf4KsIbgaGBDIrggMCOo1avX1qhk5essk6JEjwPeJhJhTz1pi1AsIQ5+4z9JFlxuK5EQnS4v9duVgL2L\/YQ87T2tzjePz6eP4Z5qR+hfyCKOqyzRhXiFWIIHO1Gnfzju8MBZTtYB\/BiG0OtM7CC1+qz8rd3MpEMZ7iUfqfCvJYM21ChSPug6bTQY7z9wfMPGkSktKU+hHqvhtxLSyims\/Ow7N9rEP\/mUbAsqMXnKujE6bic3He47K9037HAZKjoc\/bFFJZOjAGTHBwiEcZPd6FvrT6eBbDpefFHLzmv+4+I7F3rmPQD5Yo3g4nYEc72N1j8g\/Ijve32YXPDcqb5dwXyGt\/Bv2A518wpKFBaiIPa5+AyzHUHIO1dAnatscMUbiVnA9hYPeUemKMz0kTjcvMOnXus7bF8eOl\/ZAMvk5whX+jK2IU44F5603q+XoWKkF3z6ubdL8x5GoAq1XrfjGDD1oSzSImffo1I2Tz\/003ZoEwORSZ1mVPg5Nf+YroOfhqWQ\/VVnKtIthyXgacjV\/D2zEl7khZoAvP7Iq8SsbJHMp1oZgsZszg3E+mQat1PzLIUVBePYJB\/qO\/T3gES0QotnIDb51IFTA4E\/pOANyUfH0k7F+uqa9q\/BXmGCAzC9KxLv4aLfBQ9bDfzFgwld0IWgkGT8zCPP\/7uHfMRybhOE1K7\/fIPWUPsgQzVOV3\/BA0KMrBRRa97yC7KFD\/nDJB2T7DRmjgnsywXP1glb8eT2L3yn1N0QAWyYjYV8I\/plJVvx4HqmCMTtwGOkFvs8lDzh+jnDMkHojvpxAkyOezAbWrVMZqIFFq\/iRv8vVA7iunfURDbdZNESPmA1onhizSXkyTDHoJMBg5eHna+9lvVjUqnTEcUTQVVRMCe5ea7dCuuB2USkH9aN\/og14EGiUeoGoJHpbFOR+E9SL1LcFf4iKwVfH5IVI41Gws48JNQO1DNX+zwxPdEQxmDoQXKBYOiimvy\/15sEzcg1qy\/D3obbnhADiwcO2mwcY44\/iOOfdxAcRwtsskr1L+Km9OAPqfOZ+ct+FpNgqku\/gbDnXv8NCcdGmO22Dm9eB6KNvs4VntRlyZIK3I6eG4niEgDns8Ix28pgUjygIE86XfzbC9IYHlgDFezmF\/yeC6LI7Mi2VALXWqW69\/EVk8Qxp9L3BSsNuhPhTuUhHzM3sfZLGjA0d0b7j8j9E0dFuJnPmn1j6J\/CaXEZ4XaJZotRExPgKYP24HdpJ7a\/edASWqZl9BbPh8EjOsb6mkcsxIbQNuCDQbcVLv4x6f6yCBUwh1kBKqxwUqH+6DxMPZIY3D6mMf2IXsqbPAVPuqZhJeUJKfqpGbm6N55GuS6HeYCxm7LL097NqBQk8m3fClbPV8GmQPu2e\/9bkIMOn\/zQl9hBlfoH29fb9hrqvMvj3Rx39yzllFeU0aHcXZ6FWt1Pas+5rmk6f3oDKqSy7d0egcQZ5jvbypAqEHbKQF4z2IYEIW0wyWTj5W4HB3RvbK5U3lmP0W+Zavu5tNsSqGnIkr8OOGTyjJSRRNWP6TuHoUwjiUBgDu2KKY8lcRAxawuUaitBY5kr7wg1g6Xb\/xoxN6X6zBPhxZdhs1WL\/JrtNY5ta8eebgh+zYeuymxgNMF+H28zboN8cHzI+cXntNVvXptos64jLOArJul7CJUs9C88PeN7inoTTaJPMDUx5Pp6m8JrLf+HiVKoVQKHVbdTT5HHyH71hXQ9\/g8xwV1KqpuZ6iW2Y4NIQckUvM3Nt2JWUFKHmToXj0mh\/w1fOiwk7cKohGiDi6DlioeT1ZJT8hixy6nPAk0TuaKqaRqojWRrZ4Ni\/knJKJ9NX+aAOzS5jek0NiDVjfHxyIXr19BUX2nq+a53w4P1hmeReaQ99x+OEriA1NDTnT4c2HMNhQCKTLhvfDtbu5V4KGfm3SemfOxoUK1lGbUIadGCUlAIXH86VjKGb8KxY9plbtXPJwX7A+rk+V+ilrC3BsdgMEdIc4EEuZ66+pVjxDUkBLXO8SK9tUMrI\/kQCU0I5g2RTYHhjcElj59uMAeAhDPYmSepV4bMbKeSv2XvCvp3y8M02QM1T7lIxVBRvHBjRN\/rel0rF1wU+nATo6PMocoSgrxJWg03m3ylaysgFUcKLOv3gcw3NrtmgCBDSnyYhbO4Nw3bayEDqBvwI9DToE9c5fskboeY0BNXnTgqCOEHCWZOt\/Tmdde1aHBvG3ik4z8LooEEhO7uwfS5tlk7T9U6HfqydOTYCcjq1KnTYq4V3t8eeQtoUddQirKkn4deGRdMdDEVN1VOWsJ\/vbcMy65WwnW8AON\/u2Xk\/68h1qi5IBigSjCOivXDbH7q9UprfS+9IaIlavdx5HWIl3hkUTjFWz47UqBP6Ut2Yy4ESHDZYsVmiPWyobigB3CSUmIYdWgvdsdgjEwPMo9ytDLnWPUgz3XrG17PvVHH\/I2tiHF0ff6krnpZ2QuT+HQuyFmC5XbiLsuKPjh89ES2Y7g2FwmbtLpxS5zp3vUPPQ6rAgmfLXepg+LWk4Ceuf60IfZKaAjqmwJE4r+TBbRXHMogdYompcRryus1vjr7SHQRP0lDUrpwfW5bW2JVfpIsiU4LGQL2BlQxaEsrKngBxt3Evtd9m\/KysJdzmSVCfOTvxZcAbDiVkqJpH7wIC4rATxLByzoqV6P892Lsr+VBTOxlc+ZqF8vaykPqA+kUbvjYYtJATr3iAsz88PPYw5KNojKvrL8QZWVmMdlEp0quBV2oF1B+j4xRRnPPXDB8oC\/WSRxVrQHULw6aOTfkeAdRneO8\/m\/PFJP8gRcXCbRfLMKUlh1Cf0thnhW7T23PgAyTXOQxCciaWL2fC3V+gZfBp8Zf\/DJHT\/idNewFJb0FDoCA1b8qkP47vMITTwhwh0oG8kwm\/3ZQdox8HfOuQjag1PGptHgZp6IOhL1TNrG+PfQf4qeqv975kwsn\/I\/87WCLxexp39oouNGi6T+2aUjLiMdnf\/aRUqxAbs29bau9AwGkUxTOFWVZSV7IJtK7jc+n2vvHSkDHyBdnNdhC0s2Y5ZSs5N+IAnRgw8emyN\/ZG3dSrjQDbxfltZH2UZxkfAz+w+BIXcg+whuDgTeRL7esDH4tb4KUsgPYL8T6bT3lVNUj6pbkgWVQtnpPiPz\/Leqlw==:utf-8"},"name":"superuser"}],"package_definition_list":[{"description":"CentOS_7_Cloud Image","action_list":[],"type":"SUBSTRATE_IMAGE","service_local_reference_list":[],"name":"CentOS_7_Cloud","version":"","options":{"type":"","name":"CentOS_7_Cloud","resources":{"image_type":"DISK_IMAGE","checksum":{"checksum_algorithm":"","type":"","checksum_value":""},"source_uri":"http:\/\/download.nutanix.com\/calm\/CentOS-7-x86_64-GenericCloud.qcow2","version":{"product_version":"7","type":"","product_name":"CentOS"},"architecture":"X86_64","type":""},"description":""},"variable_list":[]},{"description":"CentOS 8 Cloud Image","action_list":[],"type":"SUBSTRATE_IMAGE","service_local_reference_list":[],"name":"CentOS_8_Cloud","version":"","options":{"type":"","name":"CentOS_8_Cloud","resources":{"image_type":"DISK_IMAGE","checksum":{"checksum_algorithm":"","type":"","checksum_value":""},"source_uri":"https:\/\/cloud.centos.org\/centos\/8\/x86_64\/images\/CentOS-8-GenericCloud-8.2.2004-20200611.2.x86_64.qcow2","version":{"product_version":"8","type":"","product_name":"CentOS"},"architecture":"X86_64","type":""},"description":""},"variable_list":[]},{"description":"","action_list":[],"type":"DEB","service_local_reference_list":[{"kind":"app_service","name":"WebServer"}],"name":"WebServer_Package","version":"","options":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"WebServer_Package"},"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Linux_OS_Update"},{"kind":"app_task","name":"Install_WebServer"},{"kind":"app_task","name":"2Tier_Webapp"}],"name":"5669e466_dag","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Linux_OS_Update"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Install_WebServer"}},{"from_task_reference":{"kind":"app_task","name":"Install_WebServer"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"2Tier_Webapp"}}],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"WebServer"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Linux_OS_Update","attrs":{"exit_status":[],"script":"#!\/usr\/bin\/env bash\r\n\r\nsudo yum -y update\r\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"superuser"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"WebServer"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Install_WebServer","attrs":{"exit_status":[],"script":"#!\/usr\/bin\/env bash\r\nset -ex\r\n\r\necho \"__ Install httpd and php...\"\r\nsudo yum install -y httpd\r\nsudo yum install -y php php-gd php-mbstring php-pdo php-mysqlnd\r\n\r\necho \"<IfModule mod_dir.c>\r\n        DirectoryIndex index.php index.html\r\n<\/IfModule>\" | sudo tee \/etc\/httpd\/conf.modules.d\/dir.conf\r\n\r\necho \"<?php\r\nphpinfo();\r\n?>\" | sudo tee \/var\/www\/html\/index.php\r\n\r\nsudo systemctl enable httpd\r\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"superuser"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"WebServer"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"2Tier_Webapp","attrs":{"exit_status":[],"script":"#!\/usr\/bin\/env bash\r\nset -ex\r\n\r\nsudo touch \/var\/www\/html\/index.php\r\nsudo chown @@{superuser.username}@@:@@{superuser.username}@@ \/var\/www\/html\/index.php\r\n\r\ncat > \/var\/www\/html\/index.php <<- \"EOF\"\r\n<html>\r\n<head>\r\n  <title>@@{calm_blueprint_name}@@<\/title>\r\n<\/head>\r\n<body>\r\n <h1>Hostname: @@{name}@@ at @@{address}@@, replica: @@{calm_array_index}@@<\/h1>\r\n<?php\r\n\r\ntry {\r\n  echo \"<h3>Web docroot: $_SERVER['DOCUMENT_ROOT'], file: $_SERVER['SCRIPT_NAME']<\/h3>\\n\";\r\n}\r\n\r\ncatch (PDOException $e) {\r\n  print \"Error!: \" . $e->getMessage() . \"<br\/>\";\r\n  print phpinfo();\r\n  die();\r\n}\r\n?><\/body>\r\n<\/html>\r\nEOF\r\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"superuser"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"1a58e3a1_runbook","main_task_local_reference":{"kind":"app_task","name":"5669e466_dag"},"variable_list":[]},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"WebServer_Package"},"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Uninstall_WebServer"}],"name":"2ca71d96_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"WebServer"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Uninstall_WebServer","attrs":{"exit_status":[],"script":"#!\/usr\/bin\/env bash\r\nset -ex\r\n\r\nsudo rm -rf \/var\/www\/html\/* || true\r\nsudo yum erase -y httpd php || true\r\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"superuser"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"90c0f010_runbook","main_task_local_reference":{"kind":"app_task","name":"2ca71d96_dag"},"variable_list":[]}},"variable_list":[]},{"description":"","action_list":[],"type":"DEB","service_local_reference_list":[{"kind":"app_service","name":"HAProxy"}],"name":"HAProxy_Package","version":"","options":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"HAProxy_Package"},"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Linux_OS_Update"},{"kind":"app_task","name":"HAProxy_Install"}],"name":"68a4e7db_dag","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Linux_OS_Update"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"HAProxy_Install"}}],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"HAProxy"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Linux_OS_Update","attrs":{"exit_status":[],"script":"#!\/usr\/bin\/env bash\r\n\r\nsudo yum -y update\r\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"superuser"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"HAProxy"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"HAProxy_Install","attrs":{"exit_status":[],"script":"#!\/usr\/bin\/env bash\r\nset -ex\r\n\r\necho \"__ HAProxy installation...\"\r\nsudo yum install -y haproxy &&\r\n  sudo systemctl enable haproxy\r\nhaproxy -v\r\n\r\necho \"__ HAProxy configuration...\"\r\n# http:\/\/cbonte.github.io\/haproxy-dconv\/1.8\/configuration.html#4\r\necho \"global\r\n  log 127.0.0.1 local0\r\n  log 127.0.0.1 local1 notice\r\n  maxconn 4096\r\n  quiet\r\n  user haproxy\r\n  group haproxy\r\ndefaults\r\n  log global\r\n  mode http\r\n  retries 3\r\n  timeout client 50s\r\n  timeout connect 5s\r\n  timeout server 50s\r\n  option dontlognull\r\n  option httplog\r\n  option redispatch\r\n  balance  roundrobin\r\n# Set up application listeners here.\r\nlisten stats\r\n  bind *:8080\r\n  mode http\r\n  log global\r\n  stats enable\r\n  stats hide-version\r\n  stats refresh 30s\r\n  stats show-node\r\n  stats uri \/stats\r\n#listen admin\r\n#  bind 127.0.0.1:22002\r\n#  mode http\r\n#  stats uri \/\r\nfrontend http\r\n  bind *:80\r\n  maxconn 2000\r\n  default_backend servers-http\r\nbackend servers-http\" | sudo tee \/etc\/haproxy\/haproxy.cfg\r\n\r\nsudo sed -i 's\/server host-\/#server host-\/g' \/etc\/haproxy\/haproxy.cfg\r\nhosts=$(echo \"@@{WebServer.address}@@\" | sed 's\/^,\/\/' | sed 's\/,$\/\/' | tr \",\" \"\\n\")\r\nport=80\r\n\r\nfor host in $hosts; do\r\n  echo  \"  server host-${host} ${host}:${port} weight 1 maxconn 100 check\" | sudo tee -a \/etc\/haproxy\/haproxy.cfg\r\ndone\r\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"superuser"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"6caf3343_runbook","main_task_local_reference":{"kind":"app_task","name":"68a4e7db_dag"},"variable_list":[]},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"HAProxy_Package"},"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"HAProxy_Uninstall"}],"name":"f8afc547_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"HAProxy"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"HAProxy_Uninstall","attrs":{"exit_status":[],"script":"#!\/usr\/bin\/env bash\r\n\r\nsudo yum -y erase haproxy\r\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"superuser"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"bd1fff1e_runbook","main_task_local_reference":{"kind":"app_task","name":"f8afc547_dag"},"variable_list":[]}},"variable_list":[]}],"app_profile_list":[{"deployment_create_list":[{"type":"GREENFIELD","action_list":[],"name":"fde022dc_deployment","min_replicas":"2","default_replicas":"2","depends_on_list":[],"published_service_local_reference_list":[],"max_replicas":"4","package_local_reference_list":[{"kind":"app_package","name":"WebServer_Package"}],"substrate_local_reference":{"kind":"app_substrate","name":"WebServerAWS"},"variable_list":[],"description":""},{"type":"GREENFIELD","action_list":[],"name":"fe5242fd_deployment","min_replicas":"1","default_replicas":"1","depends_on_list":[],"published_service_local_reference_list":[],"max_replicas":"1","package_local_reference_list":[{"kind":"app_package","name":"HAProxy_Package"}],"substrate_local_reference":{"kind":"app_substrate","name":"HAProxyAWS"},"variable_list":[],"description":""}],"description":"","action_list":[{"description":"","type":"user","critical":false,"runbook":{"task_definition_list":[{"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"ScaleOut"}],"name":"07fb6f99_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"fde022dc_deployment"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"ScaleOut","attrs":{"scaling_count":"1","type":"","scaling_type":"SCALEOUT"},"timeout_secs":"0","type":"SCALING","variable_list":[]}],"description":"","name":"69fd86e2_runbook","main_task_local_reference":{"kind":"app_task","name":"07fb6f99_dag"},"variable_list":[]},"name":"WebScaleOut"},{"description":"","type":"user","critical":false,"runbook":{"task_definition_list":[{"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"ScaleIn"}],"name":"722d5ec5_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"fde022dc_deployment"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"ScaleIn","attrs":{"scaling_count":"1","type":"","scaling_type":"SCALEIN"},"timeout_secs":"0","type":"SCALING","variable_list":[]}],"description":"","name":"7b3996e5_runbook","main_task_local_reference":{"kind":"app_task","name":"722d5ec5_dag"},"variable_list":[]},"name":"WebScaleIn"}],"name":"AWS","variable_list":[{"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","type":"LOCAL","name":"USER_INITIALS","value":"xyz","label":"","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"options":{"type":"PREDEFINED","choices":[]}},{"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","type":"LOCAL","name":"MYSQL_APP_USER","value":"webuser","label":"","attrs":{"type":""},"is_hidden":false,"options":{"type":"PREDEFINED","choices":[]}},{"val_type":"STRING","is_mandatory":true,"description":"","data_type":"BASE","type":"SECRET","name":"MYSQL_PASSWORD","value":"unU0TBnAMrVXa2Gkfzo6jUt1WylW6qNVMArekWUuBhA0ebhE00CkJbgq:utf-8","label":"","attrs":{"is_secret_modified":false,"secret_reference":{},"type":"SECRET"},"editables":{"value":true},"is_hidden":false,"options":{"type":"PREDEFINED","choices":[]}},{"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","type":"LOCAL","name":"DATABASE_NAME","value":"webapp","label":"","attrs":{"type":""},"is_hidden":false,"options":{"type":"PREDEFINED","choices":[]}},{"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","type":"LOCAL","name":"DATABASE_TABLE","value":"visitors","label":"","attrs":{"type":""},"is_hidden":false,"options":{"type":"PREDEFINED","choices":[]}}]}],"published_service_definition_list":[],"default_credential_local_reference":{"kind":"app_credential","name":"superuser"},"type":"USER"},"name":"AWS-2Tier-WebApp"},"api_version":"3.0","metadata":{"last_update_time":"1605990855263220","kind":"blueprint","spec_version":2,"creation_time":"1605990612439210","name":"AWS-2Tier-WebApp"}}