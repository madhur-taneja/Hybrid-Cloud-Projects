{"status":{},"contains_secrets":true,"product_version":"3.0.0.1","spec":{"description":"Production 3-Tier Application","resources":{"client_attrs":{"ec4401d1-917d-6934-62f2-a9648cf186c1":{"y":-485.4100243705,"x":-564.9828534808},"None":{"y":-77.9134742203,"x":-305.4049473312},"fe5242fd_deployment":{"y":-488.0171595982,"x":-249.3757106236},"46c9dbb8-0270-73c6-35d2-0b18468398d5":{"y":-485.4100243705,"x":-564.9828534808},"55d63b0b-dc45-b61f-4ae5-eecfec126a1e":{"y":-488.0171595982,"x":-249.3757106236},"f6db5ea6-9e7e-4989-ce46-ce4ea47302ef":{"y":-488.0171595982,"x":-249.3757106236},"a7961687-a84d-3106-6a6a-064fd049a53e":{"y":-485.4100243705,"x":-564.9828534808},"7a040723-fde3-9920-3d3f-58ffee9947c6":{"y":-488.0171595982,"x":-249.3757106236},"fde022dc_deployment":{"y":-485.4100243705,"x":-564.9828534808}},"service_definition_list":[{"singleton":false,"action_list":[{"description":"System action for creating an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"WebServer"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"c4df580e_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"46e14386_runbook","main_task_local_reference":{"kind":"app_task","name":"c4df580e_dag"},"variable_list":[]},"name":"action_create"},{"description":"System action for deleting an application. Deletes created VMs as well","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"WebServer"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"4d2cb64a_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"271b6adb_runbook","main_task_local_reference":{"kind":"app_task","name":"4d2cb64a_dag"},"variable_list":[]},"name":"action_delete"},{"description":"System action for starting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"WebServer"},"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Restart"}],"name":"ab2510b0_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"WebServer"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Restart","attrs":{"type":"CALL_RUNBOOK","inarg_list":[],"runbook_reference":{"kind":"app_runbook","name":"d46e2c6e_runbook"}},"timeout_secs":"0","type":"CALL_RUNBOOK","variable_list":[]}],"description":"","name":"c44251df_runbook","main_task_local_reference":{"kind":"app_task","name":"ab2510b0_dag"},"variable_list":[]},"name":"action_start"},{"description":"System action for stopping an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"WebServer"},"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"WebServer_Stop"}],"name":"94da3199_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"WebServer"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"WebServer_Stop","attrs":{"exit_status":[],"script":"#!\/usr\/bin\/env bash\r\n\r\nsudo systemctl stop httpd\r\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"superuser"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"2c84d11e_runbook","main_task_local_reference":{"kind":"app_task","name":"94da3199_dag"},"variable_list":[]},"name":"action_stop"},{"description":"System action for restarting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"WebServer"},"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"WebServer_Restart"}],"name":"57935661_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"WebServer"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"WebServer_Restart","attrs":{"exit_status":[],"script":"#!\/usr\/bin\/env bash\r\n\r\nsudo systemctl restart httpd\r\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"superuser"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"d46e2c6e_runbook","main_task_local_reference":{"kind":"app_task","name":"57935661_dag"},"variable_list":[]},"name":"action_restart"}],"depends_on_list":[],"name":"WebServer","port_list":[],"tier":"","variable_list":[],"description":""},{"singleton":false,"action_list":[{"description":"System action for creating an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"HAProxy"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"04955ec8_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"0f2bfa19_runbook","main_task_local_reference":{"kind":"app_task","name":"04955ec8_dag"},"variable_list":[]},"name":"action_create"},{"description":"System action for deleting an application. Deletes created VMs as well","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"HAProxy"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"12c7fcb2_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]}],"description":"","name":"28b8813e_runbook","main_task_local_reference":{"kind":"app_task","name":"12c7fcb2_dag"},"variable_list":[]},"name":"action_delete"},{"description":"System action for starting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"HAProxy"},"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Restart"}],"name":"f4f9066c_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"HAProxy"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Restart","attrs":{"type":"CALL_RUNBOOK","inarg_list":[],"runbook_reference":{"kind":"app_runbook","name":"edeab12d_runbook"}},"timeout_secs":"0","type":"CALL_RUNBOOK","variable_list":[]}],"description":"","name":"f6a4799b_runbook","main_task_local_reference":{"kind":"app_task","name":"f4f9066c_dag"},"variable_list":[]},"name":"action_start"},{"description":"System action for stopping an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"HAProxy"},"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"HAProxy_Stop"}],"name":"21e8e8bb_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"HAProxy"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"HAProxy_Stop","attrs":{"exit_status":[],"script":"#!\/usr\/bin\/env bash\r\n\r\nsudo systemctl stop haproxy\r\nsudo systemctl daemon-reload\r\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"superuser"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"f4f51310_runbook","main_task_local_reference":{"kind":"app_task","name":"21e8e8bb_dag"},"variable_list":[]},"name":"action_stop"},{"description":"System action for restarting an application","type":"system","critical":false,"runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_service","name":"HAProxy"},"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"HAProxy_Restart"}],"name":"65b16430_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"HAProxy"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"HAProxy_Restart","attrs":{"exit_status":[],"script":"#!\/usr\/bin\/env bash\r\n\r\nsudo systemctl daemon-reload\r\nsudo systemctl restart haproxy\r\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"superuser"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"edeab12d_runbook","main_task_local_reference":{"kind":"app_task","name":"65b16430_dag"},"variable_list":[]},"name":"action_restart"}],"depends_on_list":[{"kind":"app_service","name":"WebServer"}],"name":"HAProxy","port_list":[],"tier":"","variable_list":[],"description":""}],"substrate_definition_list":[{"description":"","action_list":[],"type":"AWS_VM","name":"WebServerAWS","readiness_probe":{"connection_type":"SSH","retries":"5","connection_protocol":"","connection_port":22,"address":"@@{public_ip_address}@@","delay_secs":"60","disable_readiness_probe":false,"login_credential_local_reference":{"kind":"app_credential","name":"superuser"}},"os_type":"Linux","create_spec":{"name":"aws-@@{calm_array_index}@@-@@{calm_time}@@","availability_zone_reference":null,"backup_policy":null,"type":"PROVISION_AWS_VM","cluster_reference":null,"resources":{"instance_profile_name":"","availability_zone":"us-west-2a","subnet_id":"subnet-621aca1a","key_name":"HCE-KP","region":"us-west-2","instance_initiated_shutdown_behavior":"","user_data":"#cloud-config\r\n# https:\/\/aws.amazon.com\/premiumsupport\/knowledge-center\/ec2-user-account-cloud-init-user-data\/\r\n# omit: security-group of VPC for SSH?\r\n# omit: SSH-keypair in ec2 region, skips creation: ec2-user\r\ncloud_final_modules:\r\n  - [users-groups,always]\r\nusers:\r\n  - name: @@{superuser.username}@@\r\n    groups: [ wheel ]\r\n    sudo: [ \"ALL=(ALL) NOPASSWD:ALL\" ]\r\n    shell: \/bin\/bash\r\n    ssh-authorized-keys:\r\n      - @@{superuser.public_key}@@\r\n      - ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQC8ZzG4f1TfEZ2YRgDcPSQjb+fxbtRS4m1dr\/EcqwqIxiV6nU9Ft3PrTqC8qFkhBjOvSJJ3GeEMCZnvEK9Iq8F+R0G3pa29fZeRA8Ur3PM4d2kb2ZhEYLMmnhKJoSTJw4c5PxaZ4ZXKUH+yATQUsLrwoYsHEC6bAvKl0+yFspQYehaiEEO17o3KQUq\/izU7Agi4vETAuR7\/dlKwzj1sG8fikaf351gmQhIHd+nXxIY9yTA3CpvfeKTJ77aHN0Cg+HwXg9X+c0+P\/6zMfo87oru25qnPX5ITa2TfposQWp1xASGrrJX5B6rNYuQQKzVo5OO7VfFEKDsDlzGAkDVlD797xVoq+\/HN6G5gsi82jujBb1X9kyCLGFNhXsseGcqYelBMWmHKHTp69\/vnWcjT1dCB4OWEQr5ARcxYc5zNXV4N2CVYwH4iF70ztt4Dd7\/4gmvXWmzyuc0j7gd+QHz0BwxJTGZu+MPPXu8xAYtcCSAh\/SQFzL7xhnbsIrDj2mXBwOi36vxPQ8APRstr0dtEYivwyPyVb7lzR2SGmQNlHxB\/F\/xdiHszqD+\/c4DGZqW4xj+I6ICu\/19lh3gi2rLvrGF86EPTQ3hQKtpv6\/t2O+UXONnc+Ayc5dKh6baC6IbwGQnT0tLDPTXM5+o3M2a0KefdqmzL6\/gekpATS+scqb6tPQ== mark.lavi@nutanix.com-2018-05-21-passphraseless","image_id":"ami-02f147dfb8be58a10","instance_type":"t2.micro","state":"RUNNING","security_group_list":[{"type":"","security_group_id":"sg-880a95a3"}],"block_device_map":{"data_disk_list":[],"type":"","root_disk":{"size_gb":10,"volume_type":"GP2","device_name":"\/dev\/sda1","iops":100,"snapshot_id":"","type":"","delete_on_termination":true}},"private_ip_address":"","vpc_id":"vpc-3f89ce47","tag_list":[],"type":"","account_uuid":"c49276df-f6a6-47c8-1788-2a8991c8eb96","associate_public_ip_address":true}},"variable_list":[]},{"description":"","action_list":[],"type":"AWS_VM","name":"HAProxyAWS","readiness_probe":{"connection_type":"SSH","retries":"5","connection_protocol":"","connection_port":22,"address":"@@{public_ip_address}@@","delay_secs":"60","disable_readiness_probe":false,"login_credential_local_reference":{"kind":"app_credential","name":"superuser"}},"os_type":"Linux","create_spec":{"name":"aws-@@{calm_array_index}@@-@@{calm_time}@@","availability_zone_reference":null,"backup_policy":null,"type":"PROVISION_AWS_VM","cluster_reference":null,"resources":{"instance_profile_name":"","availability_zone":"us-west-2a","subnet_id":"subnet-621aca1a","key_name":"HCE-KP","region":"us-west-2","instance_initiated_shutdown_behavior":"","user_data":"#cloud-config\r\n# https:\/\/aws.amazon.com\/premiumsupport\/knowledge-center\/ec2-user-account-cloud-init-user-data\/\r\n# omit: security-group of VPC for SSH?\r\n# omit: SSH-keypair in ec2 region, skips creation: ec2-user\r\ncloud_final_modules:\r\n  - [users-groups,always]\r\nusers:\r\n  - name: @@{superuser.username}@@\r\n    groups: [ wheel ]\r\n    sudo: [ \"ALL=(ALL) NOPASSWD:ALL\" ]\r\n    shell: \/bin\/bash\r\n    ssh-authorized-keys:\r\n      - @@{superuser.public_key}@@\r\n      - ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQC8ZzG4f1TfEZ2YRgDcPSQjb+fxbtRS4m1dr\/EcqwqIxiV6nU9Ft3PrTqC8qFkhBjOvSJJ3GeEMCZnvEK9Iq8F+R0G3pa29fZeRA8Ur3PM4d2kb2ZhEYLMmnhKJoSTJw4c5PxaZ4ZXKUH+yATQUsLrwoYsHEC6bAvKl0+yFspQYehaiEEO17o3KQUq\/izU7Agi4vETAuR7\/dlKwzj1sG8fikaf351gmQhIHd+nXxIY9yTA3CpvfeKTJ77aHN0Cg+HwXg9X+c0+P\/6zMfo87oru25qnPX5ITa2TfposQWp1xASGrrJX5B6rNYuQQKzVo5OO7VfFEKDsDlzGAkDVlD797xVoq+\/HN6G5gsi82jujBb1X9kyCLGFNhXsseGcqYelBMWmHKHTp69\/vnWcjT1dCB4OWEQr5ARcxYc5zNXV4N2CVYwH4iF70ztt4Dd7\/4gmvXWmzyuc0j7gd+QHz0BwxJTGZu+MPPXu8xAYtcCSAh\/SQFzL7xhnbsIrDj2mXBwOi36vxPQ8APRstr0dtEYivwyPyVb7lzR2SGmQNlHxB\/F\/xdiHszqD+\/c4DGZqW4xj+I6ICu\/19lh3gi2rLvrGF86EPTQ3hQKtpv6\/t2O+UXONnc+Ayc5dKh6baC6IbwGQnT0tLDPTXM5+o3M2a0KefdqmzL6\/gekpATS+scqb6tPQ== mark.lavi@nutanix.com-2018-05-21-passphraseless","image_id":"ami-02f147dfb8be58a10","instance_type":"t2.micro","state":"RUNNING","security_group_list":[{"type":"","security_group_id":"sg-880a95a3"}],"block_device_map":{"data_disk_list":[],"type":"","root_disk":{"size_gb":10,"volume_type":"GP2","device_name":"\/dev\/sda1","iops":100,"snapshot_id":"","type":"","delete_on_termination":true}},"private_ip_address":"","vpc_id":"vpc-3f89ce47","tag_list":[],"type":"","account_uuid":"c49276df-f6a6-47c8-1788-2a8991c8eb96","associate_public_ip_address":true}},"variable_list":[]}],"credential_definition_list":[{"username":"centos","description":"","type":"KEY","secret":{"attrs":{"is_secret_modified":true,"secret_reference":{}},"value":"FgSWfCwWqu9uNylRjUg0nIZ6Fs50t9XE\/KTp9MbRHvNB\/5ZDWzF9E8em9+DUV4nAd4\/UfFuE3U1VPFqzEQDPCzw8lYOus+QwDX3IM\/rA00LL1AfuikIxZCReW\/cUspH23BoHJ3htFKC99il+6\/i9HD3\/qnX5w\/Xm1zU\/rdyLFWFZKGzf68I4c0Og3ackY+mlKkdFsP4OvO9dgolVGttHMDLwZczfwmLf9UqIXV+cCE5xrGmjra7v6IDHvjQsJkL+7F5gpQmQVN8HWxLq+xCM52JJCBFAYkNGXx47PTM0PNe0djo125ZZv2hcCL5DDhEYcXDQR0SLzLYU6lUC9VPFiY9jqHG6aG7qNUMHMPDgnIyoPtxiuYhaK5lvxIfUMdYb3vPM1I01VonWfiffHP8otaYmsK996OT3J3lj8hw5yh8a\/lRimoOqaGYM6HUjWqTEffRI+g08gWTAODSSg4fvjTIZTRlcrfNs6tp4Kf478zNqpN\/M9DmR5rQg6eYl76AqS8Jf+RrEuIFCOQl1qHkUajrgjN8h00mGz4zBRUWg7KZ+WX5Ac2TKnoV2lKzi0Aj7WGch12DigpXZrR9PYVuH6J7J1aDcRkSRZM8oCRLDghRrG7XYojz1XSr7T7qhGnt32iBNGEh+TUIFBFogwlFtQl3VIpWE+4q3tXK4EWKTMn3Je5Hr+BtMW3c\/\/ro6YhXoR\/DUvHfa05NOd7FVsdKMsCXPzk3lQRtStXpB3C99honvEAsvi6koSjCyrARQatgrvRV83eWmxDPKy6BlFXnxwH61\/1w1XrHQ32J9BtYuUpqrvhtSI4l+gdq+UVGgZyxMlkvHGI4LfPJvJQ2jUiw2GaGA5KT9vpa9v\/rkqIQKaAVjNoPT2dWCg2f3Z4pUTdcjSpJHbaiwBWOOZyIibnIMQreNM7xXc\/635yhOwjhamFodBuisr9YT3EiUqfu219z++H26sLrr7N\/aVuX0dvnC88uLb1DPpmwPznbOgNsDSYyPOVS\/5S4AB6FZo\/Yb7x5OKJ\/X3V2TRNwbPngYLUg9WxNZKCjmxfpBgsheMkD7b70MYJkKLAlQCLi+4VkNhrtnnJLIMqfBnMuUsoWHWJXIkgUjXWay03tstRb0cH\/0kA+BH7WAfVqyRmmjfbwK7ez8t8fmdzm1fHE5FKd0YmQCjVMJrwrVJhSDxRYY\/ePqODXIKUMD19KGMW9vXwcShy6RvHcZLeZmtoX3ud92px07ZNZVqts4YyGGTwIyhuWhot\/f1MYsn36wQeAkSFs6cC\/AB+4M8qfWVUHqIZDki4smuMikByxjcVNeSbA+QXk0ybWIiDXF9E5JJrsq+KuXD6yyo9vKcZ2Wq7kACOBHYMBs11aAV5UMCnhc\/HkDw4HW4gQ\/Hsfl1HBF1Gff3STskpzfsNMQR8Q6O7WeyouQtGL2gpcJKCOaPgenzI7CCBHhSjhsUnI09jSpIOUchh739PIHeRHjCJcyhM4LH58G1Kk4+lq+x52Vjhkh1R1wyKwM2xKNuEk2mPV7nHdd4VNNt5qbJnHzDuXFMcs1kAZx8UFig0RsnZy\/GtTj4pgzA879l7jdh7Z72MoMko0drAV2zYJ4\/G5bDWbC1dE5jIPRktjs296k8x6Gi7QWD\/zJib4Lt8TeglrYwR1ykGcfQlwoEm6fRXYyYAqb9p2XwTh2oLtZ7AutiNWjVA2AoKrIDhLsU7c\/DvI5jcjOkiK2j4lLIJulG4jv7\/cEGYhIAVr84Qe9A\/IMYhy7sk31Im\/XB3koWryqxHOyz+aLLvrxDAWm1fc8ulLGTW9F9a7wXSAPgLS+LuncQf4wps2xp0\/xP2iR4i5GbrhMRMtGFgtje\/8UOKCSq1cdpE7++EXuq\/ChwD13GhttEI0FkNtykc7sTDl8YZPAmzGALQhtl9GPElOxSuezYJHXLv2iOGJ3kEkGLAMDlMMu1KCvw4abtLI0R\/jJ7vAoqrXzY4cjeIRN1KlNsIyg7L5CfE7MktdYk9OcS4PQFtUuAfHzcvqkNz9A+jO8vnRlGSMl+EhTHEIdfRq1Ywk3svdM+UTVdat3xrNE6K+vWROZNj+gD3039GTdfS7GIIqWVbasxvHbr6lkQ58uxoCPgmpbTV+LZw88doorG6CrhkLSMXectXQszDv9iV4f2JTmS4eytM+RyQxY2QmMAsMLSp4Vq7G15sczvA7Mu\/TgFUeU80WaykbL2mfH4wNEMJ2fWto0lcXTH6pHcbZ\/kFGjRRs0zQxWExosMP8usG4ODT2Rv2hJ5Zg0lwBAJBvmGGxbkNjmGBitxl20RE60mmL7A4egVlzfUntG\/ZWoT\/Bpw2ckZf3qqXndF3fsFtZL3Ft5kHrMz516eeOWyFVomrDbwtIkes+qYWyBQE1wke2AQTTxXABDSdNh4cOoyIQKZO\/komvq\/86wtryeOCnoesGTfZpn2xbvQGRbgeMDFBQ\/sKc9sfoOhw9b3W+9x7ggNMbFxADNPf6GBmmxR96SYSS2SSgUlNqnZy70hvn6QwtoUXjnmsRyKPwlpSNtyMyYE+ThgfEpApIM\/OWJRcTo4PVKJh4\/hVaMoTPN08TbwnY0OdstVLF8rsLeSZWLkxnX3dyzLZLgglVF8heyrnu2Sx0HVESFNsIQ3HGbBK+HH1GaZLKrcwJgPh2F4KACgPio\/56kQT2mk3DGHp5RO1Yl\/F0ZaigGoI1wIh+ThWAS1EUyIV62oKPXxt33TcGUkMdRqe1xq55+JYbJjAu\/RUuy+opq2oL4yszxRRoZij8xq6IdiEOYNqo6V3iIwBPVTArO0fq6qRpKeOdeHgDnC\/dnTwshZdPA\/qMo8T7\/YRO2tMJPZNw97eqYIllQi9J5q1VIK4PHC41+K+sil2k5zZCfk6QyS4cXGaCyCdaIz0UJlImQdly0o1MQjex1PYbMyfj1zfAT\/R9z1uKg4yuA7JvKJ8CeiqQq\/s2LcpG2d0ffQvuZzwzkBZRUNbLxscsnZdeL7FFpgiR26r8YxFS5bjL5Vrhfvo\/46Scb8wNw34ACohInZavY98yaH21gLwCUYZ6LkgsKWNERzEvijyYiFTQ1q8p7xDfDiKvfA\/F4SA\/a5+F6hC3uBht770S2HNbhvZdiIDDgEiATip4crafilaZ\/QoXIT0CTDhijWBfwHw31KuiEozpdJRJShcC25T6Zhf5ki8nMFUH5TNXNPuEkcHKhFHZ0K+OkfUCpZ75d9meBbZIyqJvENgioMU5+5clKiNLQrhwmgXD5Lcssrv7OAV2ALrC0JsWAAsRjjMmaYUVKWYPnH5RMNzWDSN3VErNcd1scraI8Z4APzp9kH\/mm9w==:utf-8"},"name":"superuser"}],"package_definition_list":[{"description":"CentOS_7_Cloud Image","action_list":[],"type":"SUBSTRATE_IMAGE","service_local_reference_list":[],"name":"CentOS_7_Cloud","version":"","options":{"type":"","name":"CentOS_7_Cloud","resources":{"image_type":"DISK_IMAGE","checksum":{"checksum_algorithm":"","type":"","checksum_value":""},"source_uri":"http:\/\/download.nutanix.com\/calm\/CentOS-7-x86_64-GenericCloud.qcow2","version":{"product_version":"7","type":"","product_name":"CentOS"},"architecture":"X86_64","type":""},"description":""},"variable_list":[]},{"description":"CentOS 8 Cloud Image","action_list":[],"type":"SUBSTRATE_IMAGE","service_local_reference_list":[],"name":"CentOS_8_Cloud","version":"","options":{"type":"","name":"CentOS_8_Cloud","resources":{"image_type":"DISK_IMAGE","checksum":{"checksum_algorithm":"","type":"","checksum_value":""},"source_uri":"https:\/\/cloud.centos.org\/centos\/8\/x86_64\/images\/CentOS-8-GenericCloud-8.2.2004-20200611.2.x86_64.qcow2","version":{"product_version":"8","type":"","product_name":"CentOS"},"architecture":"X86_64","type":""},"description":""},"variable_list":[]},{"description":"","action_list":[],"type":"DEB","service_local_reference_list":[{"kind":"app_service","name":"WebServer"}],"name":"WebServer_Package","version":"","options":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"WebServer_Package"},"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Linux_OS_Update"},{"kind":"app_task","name":"Install_WebServer"},{"kind":"app_task","name":"2Tier_Webapp"}],"name":"5669e466_dag","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Linux_OS_Update"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"Install_WebServer"}},{"from_task_reference":{"kind":"app_task","name":"Install_WebServer"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"2Tier_Webapp"}}],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"WebServer"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Linux_OS_Update","attrs":{"exit_status":[],"script":"#!\/usr\/bin\/env bash\r\n\r\nsudo yum -y update\r\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"superuser"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"WebServer"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Install_WebServer","attrs":{"exit_status":[],"script":"#!\/usr\/bin\/env bash\r\nset -ex\r\n\r\necho \"__ Install httpd and php...\"\r\nsudo yum install -y httpd\r\nsudo yum install -y php php-gd php-mbstring php-pdo php-mysqlnd\r\n\r\necho \"<IfModule mod_dir.c>\r\n        DirectoryIndex index.php index.html\r\n<\/IfModule>\" | sudo tee \/etc\/httpd\/conf.modules.d\/dir.conf\r\n\r\necho \"<?php\r\nphpinfo();\r\n?>\" | sudo tee \/var\/www\/html\/index.php\r\n\r\nsudo systemctl enable httpd\r\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"superuser"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"WebServer"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"2Tier_Webapp","attrs":{"exit_status":[],"script":"#!\/usr\/bin\/env bash\r\nset -ex\r\n\r\nsudo touch \/var\/www\/html\/index.php\r\nsudo chown @@{superuser.username}@@:@@{superuser.username}@@ \/var\/www\/html\/index.php\r\n\r\ncat > \/var\/www\/html\/index.php <<- \"EOF\"\r\n<html>\r\n<head>\r\n  <title>@@{calm_blueprint_name}@@<\/title>\r\n<\/head>\r\n<body>\r\n <h1>Hostname: @@{name}@@ at @@{address}@@, replica: @@{calm_array_index}@@<\/h1>\r\n<?php\r\n\r\ntry {\r\n  echo \"<h3>Web docroot: $_SERVER['DOCUMENT_ROOT'], file: $_SERVER['SCRIPT_NAME']<\/h3>\\n\";\r\n}\r\n\r\ncatch (PDOException $e) {\r\n  print \"Error!: \" . $e->getMessage() . \"<br\/>\";\r\n  print phpinfo();\r\n  die();\r\n}\r\n?><\/body>\r\n<\/html>\r\nEOF\r\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"superuser"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"1a58e3a1_runbook","main_task_local_reference":{"kind":"app_task","name":"5669e466_dag"},"variable_list":[]},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"WebServer_Package"},"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Uninstall_WebServer"}],"name":"2ca71d96_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"WebServer"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Uninstall_WebServer","attrs":{"exit_status":[],"script":"#!\/usr\/bin\/env bash\r\nset -ex\r\n\r\nsudo rm -rf \/var\/www\/html\/* || true\r\nsudo yum erase -y httpd php || true\r\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"superuser"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"90c0f010_runbook","main_task_local_reference":{"kind":"app_task","name":"2ca71d96_dag"},"variable_list":[]}},"variable_list":[]},{"description":"","action_list":[],"type":"DEB","service_local_reference_list":[{"kind":"app_service","name":"HAProxy"}],"name":"HAProxy_Package","version":"","options":{"install_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"HAProxy_Package"},"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"Linux_OS_Update"},{"kind":"app_task","name":"HAProxy_Install"}],"name":"68a4e7db_dag","attrs":{"edges":[{"from_task_reference":{"kind":"app_task","name":"Linux_OS_Update"},"edge_type":"user_defined","type":"","to_task_reference":{"kind":"app_task","name":"HAProxy_Install"}}],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"HAProxy"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"Linux_OS_Update","attrs":{"exit_status":[],"script":"#!\/usr\/bin\/env bash\r\n\r\nsudo yum -y update\r\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"superuser"}},"timeout_secs":"0","type":"EXEC","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"HAProxy"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"HAProxy_Install","attrs":{"exit_status":[],"script":"#!\/usr\/bin\/env bash\r\nset -ex\r\n\r\necho \"__ HAProxy installation...\"\r\nsudo yum install -y haproxy &&\r\n  sudo systemctl enable haproxy\r\nhaproxy -v\r\n\r\necho \"__ HAProxy configuration...\"\r\n# http:\/\/cbonte.github.io\/haproxy-dconv\/1.8\/configuration.html#4\r\necho \"global\r\n  log 127.0.0.1 local0\r\n  log 127.0.0.1 local1 notice\r\n  maxconn 4096\r\n  quiet\r\n  user haproxy\r\n  group haproxy\r\ndefaults\r\n  log global\r\n  mode http\r\n  retries 3\r\n  timeout client 50s\r\n  timeout connect 5s\r\n  timeout server 50s\r\n  option dontlognull\r\n  option httplog\r\n  option redispatch\r\n  balance  roundrobin\r\n# Set up application listeners here.\r\nlisten stats\r\n  bind *:8080\r\n  mode http\r\n  log global\r\n  stats enable\r\n  stats hide-version\r\n  stats refresh 30s\r\n  stats show-node\r\n  stats uri \/stats\r\n#listen admin\r\n#  bind 127.0.0.1:22002\r\n#  mode http\r\n#  stats uri \/\r\nfrontend http\r\n  bind *:80\r\n  maxconn 2000\r\n  default_backend servers-http\r\nbackend servers-http\" | sudo tee \/etc\/haproxy\/haproxy.cfg\r\n\r\nsudo sed -i 's\/server host-\/#server host-\/g' \/etc\/haproxy\/haproxy.cfg\r\nhosts=$(echo \"@@{WebServer.address}@@\" | sed 's\/^,\/\/' | sed 's\/,$\/\/' | tr \",\" \"\\n\")\r\nport=80\r\n\r\nfor host in $hosts; do\r\n  echo  \"  server host-${host} ${host}:${port} weight 1 maxconn 100 check\" | sudo tee -a \/etc\/haproxy\/haproxy.cfg\r\ndone\r\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"superuser"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"6caf3343_runbook","main_task_local_reference":{"kind":"app_task","name":"68a4e7db_dag"},"variable_list":[]},"type":"","uninstall_runbook":{"task_definition_list":[{"target_any_local_reference":{"kind":"app_package","name":"HAProxy_Package"},"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"HAProxy_Uninstall"}],"name":"f8afc547_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_service","name":"HAProxy"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"HAProxy_Uninstall","attrs":{"exit_status":[],"script":"#!\/usr\/bin\/env bash\r\n\r\nsudo yum -y erase haproxy\r\n","script_type":"sh","type":"","command_line_args":"","login_credential_local_reference":{"kind":"app_credential","name":"superuser"}},"timeout_secs":"0","type":"EXEC","variable_list":[]}],"description":"","name":"bd1fff1e_runbook","main_task_local_reference":{"kind":"app_task","name":"f8afc547_dag"},"variable_list":[]}},"variable_list":[]}],"app_profile_list":[{"deployment_create_list":[{"type":"GREENFIELD","action_list":[],"name":"fde022dc_deployment","min_replicas":"2","default_replicas":"2","depends_on_list":[],"published_service_local_reference_list":[],"max_replicas":"4","package_local_reference_list":[{"kind":"app_package","name":"WebServer_Package"}],"substrate_local_reference":{"kind":"app_substrate","name":"WebServerAWS"},"variable_list":[],"description":""},{"type":"GREENFIELD","action_list":[],"name":"fe5242fd_deployment","min_replicas":"1","default_replicas":"1","depends_on_list":[],"published_service_local_reference_list":[],"max_replicas":"1","package_local_reference_list":[{"kind":"app_package","name":"HAProxy_Package"}],"substrate_local_reference":{"kind":"app_substrate","name":"HAProxyAWS"},"variable_list":[],"description":""}],"description":"","action_list":[{"description":"","type":"user","critical":false,"runbook":{"task_definition_list":[{"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"ScaleOut"}],"name":"07fb6f99_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"fde022dc_deployment"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"ScaleOut","attrs":{"scaling_count":"1","type":"","scaling_type":"SCALEOUT"},"timeout_secs":"0","type":"SCALING","variable_list":[]}],"description":"","name":"69fd86e2_runbook","main_task_local_reference":{"kind":"app_task","name":"07fb6f99_dag"},"variable_list":[]},"name":"WebScaleOut"},{"description":"","type":"user","critical":false,"runbook":{"task_definition_list":[{"retries":"0","description":"","child_tasks_local_reference_list":[{"kind":"app_task","name":"ScaleIn"}],"name":"722d5ec5_dag","attrs":{"edges":[],"type":""},"timeout_secs":"0","type":"DAG","variable_list":[]},{"target_any_local_reference":{"kind":"app_blueprint_deployment","name":"fde022dc_deployment"},"retries":"0","description":"","child_tasks_local_reference_list":[],"name":"ScaleIn","attrs":{"scaling_count":"1","type":"","scaling_type":"SCALEIN"},"timeout_secs":"0","type":"SCALING","variable_list":[]}],"description":"","name":"7b3996e5_runbook","main_task_local_reference":{"kind":"app_task","name":"722d5ec5_dag"},"variable_list":[]},"name":"WebScaleIn"}],"name":"AWS","variable_list":[{"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","type":"LOCAL","name":"USER_INITIALS","value":"xyz","label":"","attrs":{"type":""},"editables":{"value":true},"is_hidden":false,"options":{"type":"PREDEFINED","choices":[]}},{"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","type":"LOCAL","name":"MYSQL_APP_USER","value":"webuser","label":"","attrs":{"type":""},"is_hidden":false,"options":{"type":"PREDEFINED","choices":[]}},{"val_type":"STRING","is_mandatory":true,"description":"","data_type":"BASE","type":"SECRET","name":"MYSQL_PASSWORD","value":"e0AgvixTd3MeTfleSz3Bbq1Q8235k2Y1fqZ4ZtKulPYWNEVIynxVlodW:utf-8","label":"","attrs":{"is_secret_modified":false,"secret_reference":{},"type":"SECRET"},"editables":{"value":true},"is_hidden":false,"options":{"type":"PREDEFINED","choices":[]}},{"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","type":"LOCAL","name":"DATABASE_NAME","value":"webapp","label":"","attrs":{"type":""},"is_hidden":false,"options":{"type":"PREDEFINED","choices":[]}},{"val_type":"STRING","is_mandatory":false,"description":"","data_type":"BASE","type":"LOCAL","name":"DATABASE_TABLE","value":"visitors","label":"","attrs":{"type":""},"is_hidden":false,"options":{"type":"PREDEFINED","choices":[]}}]}],"published_service_definition_list":[],"default_credential_local_reference":{"kind":"app_credential","name":"superuser"},"type":"USER"},"name":"Production-2Tier-WebApplication"},"api_version":"3.0","metadata":{"last_update_time":"1599854032605981","kind":"blueprint","spec_version":1,"creation_time":"1599850651090567","name":"Production-2Tier-WebApplication"}}